#!/usr/bin/env python
"""Print all the fields for the indicated /proc/net file

"""

import sys
import ProcHandlers
    
if sys.platform == "darwin":
    print "MacOS doesn't have a '/proc' filesystem, quitting."
    sys.exit(0)

def ShowRecsFromOneFile( ioh, proc_file, subfile):

    seq = 0

    if subfile != "":
        active = ioh(subfile)
    else:
        active = ioh(proc_file)

    for srec in active:
        seq = seq + 1
        if len(active.field) > 0:
            print "- Record {seq} fields {size}".format(seq=seq, size=len(active.field))

            fseq = 0
            for off in active.field:
                fseq = fseq + 1
                currval = active.field[off]
                if type(currval) == dict:
                    print "- - {seq}. {key} ...({size})".format(seq=fseq, key=off, size=len(currval))
                    subseq = 0
                    for subent in currval:
                        subseq = subseq + 1
                        if type(subent) == str:
                            print "- - - {seq}.{subseq}. {subkey} : {subkeyval}".format(seq=fseq, subseq=subseq, subkey=subent, subkeyval=str(currval[subent]))
                        else:
                            __skey = str(subent)
                            print "- - - {seq}.{subseq}. {subkey} : {subkeyval}".format(seq=fseq, subseq=subseq, subkey=__skey, subkeyval=str(currval[subent]))
                else:
                    print "- - {seq}. {key} : {keyval}".format(seq=fseq, key=off, keyval=str(currval))

    return

qualify = ""

if len(sys.argv) > 1:
    target = sys.argv[1]
    if len(sys.argv) > 2:
        qualify = sys.argv[2]
        fulltarget = "{target}/{subfile}".format(target=target, subfile=qualify)
    else:
        fulltarget = target
else:
    target = "tcp"
    fulltarget = target

if target == "all":

    for target in ProcHandlers.proc_file_handler_registry:
        print "- Logical records from {file} using {handler}".format(file=target, handler=str(ProcHandlers.proc_file_handler_registry[target]))

        ShowRecsFromOneFile( ProcHandlers.proc_file_handler_registry[target], target, "")
        print ""

else:
    handler = ProcHandlers.GetProcFileHandler(target)
    nohandler = ProcHandlers.GetProcFileHandler("null")

    if handler == nohandler:
        print "- No handler available for file {file}".format(file=fulltarget)
    else:
        print "- Logical records from {file} using {handler}".format(file=fulltarget, handler=str(handler))

        ShowRecsFromOneFile( handler, target, qualify)
